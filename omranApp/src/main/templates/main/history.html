{% extends 'base.html'%}
{% load static %} 
{% block header%}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>history</title>
    <link rel="stylesheet" href="{% static 'nicepage.css' %}"  media="screen">
<link rel="stylesheet" href="{% static 'history.css' %}"   media="screen">
    <script class="u-script" type="text/javascript" src="{% static 'history_jquery.js' %}" defer=""></script>
    <script class="u-script" type="text/javascript" src="{% static 'history_nicepage.js' %}"  defer=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/json2/20160511/json2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/json2/20160511/json2.min.js"></script>
    <meta name="generator" content="Nicepage 5.6.2, nicepage.com">
    <meta name="referrer" content="origin">
    <style>
      .hidden {
  opacity: 0;
  transition: opacity 0.2s ease-out;
}
    </style>
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    
    
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": "historique",
		"logo": "images/default-logo.png"
}</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="history">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
  <meta data-intl-tel-input-cdn-path="intlTelInput/">

  <style>
    body {font-family: Arial, Helvetica, sans-serif;}
    
    /* The Modal (background) */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      padding-top: 100px; /* Location of the box */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgb(0,0,0); /* Fallback color */
      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }
    
    /* Modal Content */
    .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 50%;
    }
    
    /* The Close Button */
    .close {
      color: #aaaaaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    
    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }
    </style>
  {% endblock header%}
  {% block body %}
  <header class="u-clearfix u-grey-10 u-header u-header" id="sec-506b"><div class="u-clearfix u-sheet u-valign-middle-sm u-valign-middle-xs u-sheet-1">
        <a href="https://nicepage.com" class="u-align-right u-image u-logo u-image-1">
          <img src="/static/img/default-logo.png" class="u-logo-image u-logo-image-1">
        </a>
        <a href="home" class="u-align-left u-border-hover-grey-75 u-border-none u-btn u-button-style u-none u-btn-1"><span class="u-file-icon u-icon u-text-custom-color-1 u-icon-1"><img src="/static/img/318477-d74e274b.png" alt=""></span>
          <br>
        </a>
      </div></header>
    <section class="u-clearfix u-grey-10 u-valign-top-xs u-section-1" id="sec-9891">
      <div class="u-container-align-center-lg u-container-align-center-md u-container-align-center-sm u-container-align-center-xs u-container-style u-grey-5 u-group u-radius-20 u-shape-round u-group-1">
        <div class="u-container-layout u-valign-middle-md u-valign-middle-sm u-valign-middle-xs u-container-layout-1">
          <div class="u-expanded-width u-form u-form-1">



            <form method="post" class="u-clearfix u-form-spacing-15 u-form-vertical u-inner-form" style="padding: 15px;"  name="form" id="my-form">
              {% csrf_token %}
              <div class="u-form-group u-form-input-layout-horizontal u-form-radiobutton u-label-top">
                <label class="u-label u-label-1">&nbsp;Suppression</label>
                <div class="u-form-radio-button-wrapper">
                  <div class="u-input-row">
                    <input id="field-12e3" type="radio" name="Suppression" value="true" class="u-field-input" checked="checked" data-calc="">
                    <label class="u-field-label" for="field-12e3" style="font-size: 1.125rem;">Yes</label>
                  </div>
                  <div class="u-input-row">
                    <input id="field-bb90" type="radio" name="Suppression" value="false" class="u-field-input" data-calc="">
                    <label class="u-field-label" for="field-bb90" style="font-size: 1.125rem;">No</label>
                  </div>
                  <div class="u-input-row">
                    <input id="field-1596" type="radio" name="Suppression" value="" class="u-field-input" data-calc="">
                    <label class="u-field-label" for="field-1596" style="font-size: 1.125rem;">Oui et No</label>
                  </div>
                </div>
              </div>
              <div class="u-form-group u-form-input-layout-horizontal u-form-radiobutton u-label-top">
                <label class="u-label u-label-2">Encaisser</label>
                <div class="u-form-radio-button-wrapper">
                  <div class="u-input-row">
                    <input id="field-0f0a" type="radio" name="Encaisser" value="true" class="u-field-input" checked="checked" data-calc="">
                    <label class="u-field-label" for="field-0f0a" style="font-size: 1.125rem;">Oui</label>
                  </div>
                  <div class="u-input-row">
                    <input id="field-31ea" type="radio" name="Encaisser" value="false" class="u-field-input" data-calc="">
                    <label class="u-field-label" for="field-31ea" style="font-size: 1.125rem;">No</label>
                  </div>
                  <div class="u-input-row">
                    <input id="field-cb5f" type="radio" name="Encaisser" value="" class="u-field-input" data-calc="">
                    <label class="u-field-label" for="field-cb5f" style="font-size: 1.125rem;">Oui et No</label>
                  </div>>
                </div>
              </div>
              <div class="u-form-date u-form-group u-form-input-layout-horizontal u-label-top">
                <label for="date-cef4" class="u-label u-label-3">Avant la date</label>
                <input type="text" readonly="readonly" placeholder="DD/MM/YYYY" id="date-cef4" name="date_from" class="u-input u-input-rectangle"  data-date-format="dd/mm/yyyy">
              </div>
              <div class="u-form-date u-form-group u-form-input-layout-horizontal u-label-top">
                <label for="date-d316" class="u-label u-label-4">Après la date</label>
                <input type="text" readonly="readonly" placeholder="MM/DD/YYYY" id="date-d316" name="date-to" class="u-input u-input-rectangle" data-date-format="dd/mm/yyyy">
              </div>
              <div class="u-align-center u-form-group u-form-submit u-label-top">
                <a href="#" class="u-btn u-btn-round u-btn-submit u-button-style u-radius-10 u-btn-1"><span class="u-icon"></span>Recharche 
                </a>
                <input type="submit" value="submit" class="u-form-control-hidden">
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="u-table u-table-responsive u-table-1" id="query">
        <table class="u-table-entity">
          <colgroup>
            <col width="15.29%">
            <col width="12.66%">
            <col width="14.87%">
            <col width="17.84%">
            <col width="14.06%">
            <col width="18.31%">
            <col width="6.97%">
          </colgroup>
          <thead class="u-align-center u-grey-25 u-table-header u-text-black u-table-header-1">
            <tr style="height: 77px;">
              <th class="u-table-cell">N° de commande</th>
              <th class="u-table-cell">
                <span class="u-text-black">N° de table</span>
              </th>
              <th class="u-table-cell">La date<br>
              </th>
              <th class="u-grey-25 u-table-cell u-table-cell-4">&nbsp;Suppression</th>
              <th class="u-grey-25 u-table-cell u-table-cell-5">Encaisser</th>
              <th class="u-grey-25 u-table-cell u-table-cell-6">Liste des achats</th>
              <th class="u-grey-25 u-table-cell u-table-cell-7"></th>
            </tr>
          </thead>
          
          {% for comnd in commands %}
          <tbody class="u-align-center u-grey-5 u-table-body u-text-black u-table-body-1" id="div{{comnd.id}}" >
            <tr style="height: 69px;">
              <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">{{comnd.id}}<br>
              </td>
              {% if comnd.commType %}
                   <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">{{comnd.tableNum}}</td>
              {% else %}
                   <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell"> / </td>
              {% endif %}

              <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">{{comnd.dateComm}}<br>
              </td>
              <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">{{comnd.flaged}}</td>
              <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">{{comnd.encaisser}}</td>
              <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">
                <button class="u-border-none u-btn u-btn-round u-button-style u-custom-color-3 u-radius-10 u-btn-2" id='{{comnd.id}}'onclick="openModal({{comnd.prodNames}},'{{comnd.id}}','{{comnd.commPrice}}',{{comnd.prods_quantity}},{{prod_price}})"">Afficher</button>
              </td>
              <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">
                <a class="u-border-none u-btn u-button-link u-button-style u-none u-btn-3" href="https://nicepage.com"><span class="u-file-icon u-icon u-icon-2"><img src="/static/img/3687412.png" alt=""></span>
                </a>
              </td>
            </tr>
          </tbody>
          
          {% endfor %}
        

        </table>
      </div>
    </section>
    
    
    <script>
      function openModal(prodNames,buttonId,price,prods_quant,prod_price) {
       
      
        
        
        // Get the modal element
        var modal = document.getElementById(buttonId+ "-modal");
      
        // If the modal doesn't exist, create it
        if (!modal) {
          modal = document.createElement("div");
          //modal.style="width:50%;"
          modal.id = buttonId + "-modal";
          modal.classList.add("modal");
      
          // Add some content to the modal
          var modalContent = document.createElement("div");
          modalContent.classList.add("modal-content");
          modal.appendChild(modalContent);
      
          var modalHeader = document.createElement("h2");
          modalHeader.textContent = "La liste" ;
          modalContent.appendChild(modalHeader);
      
          var modalText = document.createElement("p");
          //modalText.textContent = "<br>Modal text " + buttonId+' ';
          s=`<style>
                            /* Style the table with the 'command-table' class */
                            table.command-table {
                              border-collapse: collapse;
                              width: 100%;
                              max-width: 500px;
                              margin: 0 auto;
                            }
                            
                            /* Style the table header */
                            table.command-table th {
                              background-color: #f2f2f2;
                              color: #555;
                              font-weight: bold;
                              text-align: center;
                              padding: 10px;
                            }
                            
                            /* Style the table rows */
                            table.command-table tr {
                              border-bottom: 1px solid #ddd;
                              
                            }
                            
                            /* Style the table data */
                            table.command-table td {
                              padding: 10px;
                              text-align: center;
                            }
                            
                            /* Style the first row differently */
                            table.command-table tr:first-child {
                              font-weight: bold;
                            }
                            
                          </style>`
          s+=`<table class="command-table">
                              <thead>
                                <tr> <center>
                                  <th>Command</th> <th>quantité</th>  <th>prix</th>  </center>
                                </tr>
                              </thead>
                              `
          for (let i = 0; i < prodNames.length; i++) {
            s+=`<tbody><tr>
                                  <td>`+prodNames[i]+`</td>
                                  <td>`+prods_quant[prodNames[i]]+`</td>  
                                  <td>`+prod_price[prodNames[i]]+`</td>                                 
                                </tr></tbody>`
            
          }
          s+=`
                          `
          s+=` <tfoot>
          
                            
                                <tr > 
                                <th >Total  :</th>
                                <th>`+price+` DA</th>
                                </tr>
                                </tfoot>
                              </table>
                              <br>
          
          
          `
          modalContent.innerHTML+=s
          //modalContent.appendChild(modalText);
          
          var closeButton = document.createElement("button");
          closeButton.textContent = "Close";
          
          closeButton.addEventListener("click", function() {
            closeModal(buttonId);
          });
          modalContent.appendChild(closeButton);
      
          // Add the modal to the body of the document
          document.body.appendChild(modal);
        }
      
        // Show the modal
        modal.style.display = "block";
      
      }
      
      function closeModal(buttonId) {
        var modal = document.getElementById(buttonId + "-modal");
        modal.style.display = "none";
      }
    </script>
  


  <script>
    $(function() {
      
      $('#my-form').on('submit', function(event) {
        event.preventDefault();
        $.ajax({
          url: '/history_submit',
          type: 'POST',
          data: $(this).serialize(),
          success: function(response) {
            for (let i = 0; i < response.ids.length; i++) {
             hide(response.ids[i])
              
            }
            for (let i = 0; i < response.commands.length; i++) {
             show(response.commands[i].id)
              
            }
            /* var query=document.getElementById("query");
            
            s=`<table class="u-table-entity">
                  <colgroup>
                    <col width="15.29%">
                    <col width="12.66%">
                    <col width="14.87%">
                    <col width="17.84%">
                    <col width="14.06%">
                    <col width="18.31%">
                    <col width="6.97%">
                  </colgroup>
                  <thead class="u-align-center u-grey-25 u-table-header u-text-black u-table-header-1">
                    <tr style="height: 77px;">
                      <th class="u-table-cell">N° de commande</th>
                      <th class="u-table-cell">
                        <span class="u-text-black">N° de table</span>
                      </th>
                      <th class="u-table-cell">La date<br>
                      </th>
                      <th class="u-grey-25 u-table-cell u-table-cell-4">&nbsp;Suppression</th>
                      <th class="u-grey-25 u-table-cell u-table-cell-5">Encaisser</th>
                      <th class="u-grey-25 u-table-cell u-table-cell-6">Liste des achats</th>
                      <th class="u-grey-25 u-table-cell u-table-cell-7"></th>
                    </tr>
                  </thead>`
           
            
            for (let i = 0; i < response.commands.length; i++) {
                
              
            
                s=s+`<tbody class="u-align-center u-grey-5 u-table-body u-text-black u-table-body-1">
                    <tr style="height: 69px;">
                      <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">`+response.commands[i].id+`<br>
                      </td>
                      `
                      if (response.commands[i].tableNum==true) {
                        s=s+` <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">`+response.commands[i].tableNum+`</td>
                      `
                      } else {
                        s=s+`<td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell"> / </td>`
                      }
                         
                      s=s+ `

                      <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">`+response.commands[i].dateComm+`<br>
                      </td>
                      <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">`+response.commands[i].flaged+`</td>
                      <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">`+response.commands[i].encaisser+`</td>
                      <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">
                        <button class="u-border-none u-btn u-btn-round u-button-style u-custom-color-3 u-radius-10 u-btn-2" id='`+response.commands[i].id+`}}' onclick="openModal('${response.commands[i].prods_quantity})','`+response.commands[i].id+`','`+response.commands[i].commPrice+`','`+{}+`',{})"">Afficher</button>
                      
                      </td>
                      <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">
                        <a class="u-border-none u-btn u-button-link u-button-style u-none u-btn-3" href="https://nicepage.com"><span class="u-file-icon u-icon u-icon-2"><img src="/static/img/3687412.png" alt=""></span>
                        </a>
                      </td>
                    </tr>
                  </tbody>`
                  
        
                }
               
                
      
            s=s+"</table>"
            query.innerHTML=s */
          },
          error: function(xhr, status, error) {
            // handle error response
          }
        });
      });
    });
    function hide(id){
      document.getElementById("div"+id).style.display= 'none';
     
    }
    function show(id){
      d=document.getElementById("div"+id).style.display= 'table-row-group';
      
      
    }
    </script>
    {% endblock body %}