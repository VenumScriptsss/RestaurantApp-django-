{% extends 'base.html'%}
{% block title %}
    {%if userType == '1' %}
      Caissier Admin
    {% elif userType == '2' %}
      Caissier
    {% else %}
      Serveur
    {% endif %}      
{% endblock title%}
{% load static %}
{% block header%}
  <link rel="stylesheet" href="{% static 'home_admin.css' %}" media="screen"  >
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <meta name="keywords" content="">
  <meta name="description" content="">
  <link rel="stylesheet" href="{% static 'home_nicepage.css' %}" media="screen">
  <link rel="stylesheet" href="{% static 'header.css' %}" media="screen">
  <script class="u-script" type="text/javascript" src="{% static 'home_jquery.js' %}" defer=""></script>
  <script class="u-script" type="text/javascript" src="{% static 'home_nicepage.js' %}" defer=""></script>
  <meta name="generator" content="Nicepage 5.6.2, nicepage.com">
  <style>
    
    body {font-family: Arial, Helvetica, sans-serif;}
    
    /* The Modal (background) */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      padding-top: 100px; /* Location of the box */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgb(0,0,0); /* Fallback color */
      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }
    
    /* Modal Content */
    .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 50%;
    }
    
    /* The Close Button */
    .close {
      color: #aaaaaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    
    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
  
  <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
  <style>
    .test{
        margin-top: 5px;
        text-align: center;
    }
    .confermedButton{
        padding: 0px 15px;
        height: 42px;
        font-size: 16px;
        margin: 5px auto;
        vertical-align: middle;
        border-radius: 10px ;
        background-color: #3d8905;
        border: 0px;
        color: #ffffff;
        cursor: pointer;
    }

  .u-section-1 .u-group-1 {
  height: 80px;
  background-image: none;
  width: 105%;
  margin: 20px 2.5% 20px -2.5%;
 
  
}
.hidden_button{
  float: right;
  margin: auto 10px auto auto  ;
  display: inline-block;
  padding: 0;
}
.hidden_button1{
  margin: auto 10px ;
  display: inline-block;
  padding: 0;
}
.u-section-1 .u-btn-3 {
  font-size: 1.125rem;
  width: 220px;
  text-align: center;
  display: inline-block;
  margin: auto  ;
  padding: 10px 0px;

}


  .u-section-1 .u-btn-1 {
  width: 170px;
  font-size: 1.125rem;
  text-align: center;
  display: inline-block;
  
  margin: auto 10px auto auto  ;
  padding: 10px 0px;
  
}

.u-section-1 .u-btn-0 {
  font-size: 1.125rem;
  width: 170px;
  text-align: center;
  display: inline-block;
  
  margin: auto 10px    ;
  padding: 10px 0px;

}

.u-section-1 .u-btn-2 {
  font-size: 1.125rem;
  width: 170px;
  text-align: center;
  display: inline-block;
  padding: 10px 0px;
  margin: auto 0px auto 10px ;}

  @media (max-width: 1191px) { 
    .u-section-1 .u-group-1 {
  width: 115%;
  margin: 20px 7.5% 20px -7.5%;
}
.u-section-1 .u-btn-0 ,.u-section-1 .u-btn-1 ,.u-section-1 .u-btn-2 {
  font-size: 1rem;
  width: 140px;

}
.u-section-1 .u-btn-0{margin: auto 5px ;}
.u-section-1 .u-btn-1{margin: auto 5px auto auto ;}
.u-section-1 .u-btn-2{margin: auto 5px;}

.u-section-1 .u-btn-3 {
  font-size: 1rem;
  width: 180px;}}


  @media (max-width: 991px) { 
    .u-section-1 .u-group-1 {
  width: 110%;
  margin: 20px 5% 20px -5%;
}

.u-section-1 .u-btn-0 ,.u-section-1 .u-btn-1 ,.u-section-1 .u-btn-2 {
  font-size: 1rem;
  width: 150px;

}

.u-section-1 .u-btn-3 {
  font-size: 1rem;
  width: 180px;
 
  
  
}
}
@media (max-width: 770px) { 
    .u-section-1 .u-group-1 {
  width: 120%;
  margin: 20px 10% 20px -10%;
}
.u-section-1 .u-btn-0 ,.u-section-1 .u-btn-1 ,.u-section-1 .u-btn-2 {
  font-size: 1rem;
  width: 130px;

}

.u-section-1 .u-btn-3 {
  font-size: 1rem;
  width: 170px;
  
  
}
}


@media (max-width: 575px) { 
    .u-section-1 .u-group-1 {
  width: 130%;
  height: 160px;
  margin: 20px 15% 20px -15%;
  position: relative;
}
.hidden_button1{
 position: absolute;
 width: 50%;
 margin: 25px 25%;

}
.hidden_button{
  width: 100%;
  margin: auto 1% 30px 1%;

}


.u-section-1 .u-btn-0 ,.u-section-1 .u-btn-1 ,.u-section-1 .u-btn-2 {
  font-size: 1rem;
  width: 30%;
  margin: auto 1.3%;

}
.u-section-1 .u-btn-3 {

  display: block;
}
}
@media (max-width: 450px) {
    .u-section-1 .u-group-1 {
    width: 100%;
    height: 120px;
    margin-left: 0;
    margin-right: 0;
    padding-left: 0px;
    padding-right: 0px;
    
  }


    .u-section-1 .u-table-1 {
      margin-left: 0px;
    width: 100%;
  }
  
  

}







  </style>
  
  <script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "logo": "images/default-logo.png"
}</script>
  <meta name="theme-color" content="#478ac9">
  <meta property="og:title" content="home_admin">
  <meta property="og:type" content="website">
  <meta data-intl-tel-input-cdn-path="intlTelInput/">
{% endblock header%}

{% block body%}

  <body class="u-body u-xl-mode" data-lang="en">
    {% include 'header3.html' %}
    <section class="u-clearfix u-grey-10 u-section-1" id="sec-9891">
      <div class="u-clearfix u-sheet u-sheet-1" >
        <div class="u-container-style u-grey-5 u-group u-radius-20 u-shape-round u-group-1" >
            <div class="hidden_button1">

              <a href="ajouter-command" class="u-align-center u-btn u-btn-round u-button-style u-custom-color-3 u-radius-10 u-btn-3">Ajouter commande<br>
              </a>
            </div>
            
            <div class="hidden_button">
              {% if userType == '1' %}
            
              <a href="editer-products" class="u-align-right u-btn u-btn-round u-button-style u-radius-10 u-btn-1">Les produits</a>
              <a href="user_list" class="u-align-right u-btn u-btn-round u-button-style u-radius-10 u-btn-0">Les utilisatuer</a>
              <a href="history" class="u-align-right u-btn u-btn-round u-button-style u-radius-10 u-btn-2">Historique</a>
              {% endif %}
            </div>
            
              
            
            
         
        </div>
        <div class="u-table u-table-responsive u-table-1" >
          <table class="u-table-entity" >
            <colgroup>
              <col width="17.74%">
              <col width="18.39%">
              <col width="40.65%">
              <col width="3.23%">
              {% if userType == '1' or userType == '2' %}
                <col width="20%">
              {% endif %}
            </colgroup>
            <thead class="u-align-center u-grey-25 u-table-header u-text-black u-table-header-1">
              <tr style="height: 46px;">
                <th class="u-table-cell">
                  <span class="u-text-black">N° de table</span>
                </th>
                <th class="u-table-cell">date de saisie</th>
                <th class="u-table-cell">Prix total<br>
                </th>
                <th class="u-grey-25 u-table-cell u-table-cell-4"></th>
                {% if userType == '1' or userType == '2' %}
                  <th class="u-grey-25 u-table-cell u-table-cell-5"></th>
                {% endif %}
              </tr>
            </thead>
            <tbody class="u-align-center u-grey-5 u-table-body u-text-black u-table-body-1">
              {% for comm in commands %}
              {% if comm.encaisser is False %}
                
                <tr style="height: 60px;" id="commTr_{{comm.id}}">
                  {% if comm.tableNum == '-1' %}
                    <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">Emporter</td>
                  {% else %}
                    <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">{{comm.tableNum}}</td>
                  {% endif%}
                  <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">{{comm.dateComm|date:'d-m-Y'}}<br>
                  </td>
                  <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">{{comm.commPrice}} DA<br>
                  </td>    
                  <form method="post" action="editer-command">{% csrf_token %}
                  <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">
                      <button type="submit" name="edit" value={{comm.id}} class="u-border-2 u-border-grey-75 u-btn u-btn-round u-button-style u-custom-color-1 u-hover-custom-color-2 u-radius-8 u-text-body-alt-color u-text-hover-white u-btn-4" target="_blank">Editer<br>
                      </button>
                  </td>
                </form>
              {% if userType == '1' or userType == '2' %}
                <td class="u-border-1 u-border-grey-5 u-border-no-left u-border-no-right u-table-cell">
                    <button name="encaissment"   class="u-btn u-btn-round u-button-style u-hover-palette-1-dark-1 u-palette-1-base u-radius-8 u-btn-5"onclick="openModal({{comm.prodNames}},'{{comm.id}}','{{comm.commPrice}}',{{comm.prods_quantity}},{{prod_price}})"">encaisser</button>
                </td>
              {% endif %}
                </tr>
                {% endif %}
              {% endfor %}
              

              
            </tbody>
          </table>
        </div>
      </div>
    </section>
    
    
 <script>

  function removeComm(obj){
        document.getElementById("commTr_"+obj).remove();
        document.getElementById(obj+ "-modal").style.display = "none";

        $.ajax({
          url: '/encaicement',
          type: 'POST',
          data:{'id':obj},
          success: function(response) {},
          error: function(xhr, status, error) {}

        })
    };
    
 </script>
 
 <script>
  function printer(s){
      
      widget=document.getElementById(s+"-printContent")
      console.log(widget.innerHTML)
      str=`<style>

   
.general_div{

    display: none;
    background-color: rgba(0, 0, 0, 30%);
    border: 0px solid;
    justify-content: center;
    position:absolute;
    top:0px;
    right:0px;
    bottom:0px;
    left:0px;

}

.confermedButton{
     padding: 0px 15px;
     height: 42px;
     font-size: 16px;
     margin: 5px auto;
     vertical-align: middle;
     border-radius: 10px ;
     background-color: #3d8905;
     border: 0px;
     color: #ffffff;
     cursor: pointer;
 }

.myModel{
    background-color: #f2f2f2;
    border: 0px solid;
    margin-top:5%;
    margin-left: auto;
    margin-right: auto;
    
    justify-content: center;
    
    height: 570px;
    width: 380px;
    border-radius: 20px;
}

.closeButton{
    
    margin: 13px 8px;
    display: inline-block;
    float : right;
    border-radius: 5px;
    background-color: rgb(180, 180, 180);
    width: 26px;
    height:20px;
    font-size: 1em;
    border: 0px;
    cursor: pointer;
    
}
.title{
    width: 200px;
    margin: 10px auto 10px 60px;
    display: inline-block;
    font-size:20px;}

.iconClose{
    
    width: 90%;
    height: 90%;}

.head{
    white-space: nowrap;
    width: 100%;
}

.div_table{
    overflow-y: auto;
    background-color: #ffffff;
    border: 0px solid;
    margin: 0px auto;
    vertical-align: middle;
    height: 73%;
    width: 95%;
    border-radius: 10px;

}

.table {
    margin: 10px auto;
    border-collapse: collapse;
    text-align: center;
    vertical-align: middle;
    font-size: 16px;
}

tr.borders{
    height: 40px;
    border-top: 1.5px solid black;
    border-bottom: 1px solid black;
}

td.td_style{font-size: 15px}

@media (max-width: 768px) {

.myModel{
    
    height: 570px;
    width: 340px;
    border-radius: 18px;
    margin-top:5%;
}
.confermedButton{
     
     height: 38px;
     font-size: 14px;}
    
.title{
  margin: 10px auto 10px 80px;
    font-size: 18px;
    vertical-align: middle;
  }

.table{font-size: 14px;}

tr.borders{
    font-size: 15px;
    height: 35px;
    
}



}
                        
                      </style>
      
      `
      str=`<div class="head"><h4 class="title">liste des commandes</h4> </div>`+str
      var popupWindow = window.open('home', '_blank', 'width=600,height=400');
        popupWindow.document.write('<html><head><title>Print Div</title>');
        popupWindow.document.write('<link rel="stylesheet" href="/path/to/your/stylesheet.css">');
        popupWindow.document.write('</head><body>');
        popupWindow.document.write(str+widget.innerHTML);
        popupWindow.document.write('</body></html>');
        popupWindow.document.close();
        popupWindow.focus();
        popupWindow.print();
        popupWindow.close();
        popupWindow.addEventListener('load', function() {
            popupWindow.print();
            popupWindow.close();
        }, true);
        
   
      
    }
</script>
</div>

<!-------------------------------------------------------->

 <script>
  function openModal(prodNames,buttonId,price,prods_quant,prod_price) {
       
      
        
        
       // Get the modal element
       var modal = document.getElementById(buttonId+ "-modal");
     
       // If the modal doesn't exist, create it
       if (!modal) {
         modal = document.createElement("div");
         //modal.style="width:50%;"
         modal.id = buttonId + "-modal";
         modal.classList.add("general_div");
     
         
     
         s=`<style>

   
   .general_div{
   
       display: none;
       background-color: rgba(0, 0, 0, 30%);
       border: 0px solid;
       justify-content: center;
       position:absolute;
       top:0px;
       right:0px;
       bottom:0px;
       left:0px;

   }

   .confermedButton{
        padding: 0px 15px;
        height: 42px;
        font-size: 16px;
        margin: 5px auto;
        vertical-align: middle;
        border-radius: 10px ;
        background-color: #3d8905;
        border: 0px;
        color: #ffffff;
        cursor: pointer;
    }

   .myModel{
       background-color: #f2f2f2;
       border: 0px solid;
       margin-top:5%;
       margin-left: auto;
       margin-right: auto;
       
       justify-content: center;
       
       height: 570px;
       width: 380px;
       border-radius: 20px;
   }

   .closeButton{
       
       margin: 13px 8px;
       display: inline-block;
       float : right;
       border-radius: 5px;
       background-color: rgb(180, 180, 180);
       width: 26px;
       height:20px;
       font-size: 1em;
       border: 0px;
       cursor: pointer;
       
   }
   .title{
       width: 200px;
       margin: 10px auto 10px 60px;
       display: inline-block;
       font-size:20px;}

   .iconClose{
       
       width: 90%;
       height: 90%;}

   .head{
       white-space: nowrap;
       width: 100%;
   }

   .div_table{
       overflow-y: auto;
       background-color: #ffffff;
       border: 0px solid;
       margin: 0px auto;
       vertical-align: middle;
       height: 73%;
       width: 95%;
       border-radius: 10px;

   }

   .table {
       margin: 10px auto;
       border-collapse: collapse;
       text-align: center;
       vertical-align: middle;
       font-size: 16px;
   }

   tr.borders{
       height: 40px;
       border-top: 1.5px solid black;
       border-bottom: 1px solid black;
   }

  td.td_style{font-size: 15px}

@media (max-width: 768px) {

   .myModel{
       
       height: 570px;
       width: 340px;
       border-radius: 18px;
       margin-top:5%;
   }
   .confermedButton{
        
        height: 38px;
        font-size: 14px;}
       
   .title{
     margin: 10px auto 10px 80px;
       font-size: 18px;}

   .table{font-size: 14px;}

   tr.borders{
       font-size: 15px;
       height: 35px;
       
   }


   
}
                           
                         </style>`


         s+=`<div class="myModel">
          
               <div class="head"><h4 class="title">liste des commandes</h4>
                   <button id="closedButton${buttonId}" class="closeButton"><img class="iconClose" src="media/657059.png" alt="">
                   </button>
               </div>    
               <div id=${buttonId}-printContent>
               <div class="div_table">
                       <table class="table">
                       <colgroup>
                           <col width="45%">
                           <col width="15%">
                           <col width="40%">
                           
                       </colgroup>
                       <thead>
                           <tr> <center>
                             <th>Command</th> <th>Qté</th>  <th>prix</th> </center>
                           </tr>
                         </thead>
                       <tbody class="">` 
                         for (let i = 0; i < prodNames.length; i++) {
                         s+=`
                           <tr style="height: 40px;">
                           <td class="td_style">`+prodNames[i]+`</td>
                           <td class="td_style">`+prods_quant[prodNames[i]]+`</td>
                           <td class="td_style">`+prod_price[prodNames[i]]+` DA</td>
                           
                           </tr>`  }
                           
                           s+=`  
                       </tbody>
                       <tfoot >
                           <tr class="borders">
                           <td > <b>TOTAL: <b></td>
                           <td  colspan="2"><b>`+price+` DA</b></td>
                           </tr>
                       </tfoot>
                       </table>
               </div >
               </div>
               <div class="test">
                    <button class="confermedButton" onclick="removeComm('${buttonId}')">Encaisser</button><br>
                    <button  class="confermedButton" onclick="printer(${buttonId})"> Imprimer</button>
                </div>
               
               </div>
                             `
         
                             modal.innerHTML+=s
         
         
         
     
         // Add the modal to the body of the document
         document.body.appendChild(modal);
       }
       modal.style.display = "block";

       closedbutton=document.getElementById("closedButton"+buttonId);

       closedbutton.onclick=function(){

         modal.style.display = "none";}
       window.onclick = function(event) {
         if (event.target == modal) {
        modal.style.display = "none";}}


        
     
     }
    
  
  
</script>

<!------------------printer-->
<div>
  
{% endblock body %}
